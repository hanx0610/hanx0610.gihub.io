<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">








<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="nodejs," />





  <link rel="alternate" href="/atom.xml" title="hanx の 碎片栈" type="application/atom+xml" />






<meta name="description" content="创建服务器12345678910var  http  =  require(&apos;http&apos;);http.createServer(function  (request,  response)  &amp;#123;  	//请求头    response.writeHead(200,  &amp;#123;&apos;Content-Type&apos;:  &apos;text/html;  charset=utf-8&apos;&amp;#125;);">
<meta name="keywords" content="nodejs">
<meta property="og:type" content="article">
<meta property="og:title" content="nodeJs入门">
<meta property="og:url" content="http://yoursite.com/2016/05/21/nodeJs入门/index.html">
<meta property="og:site_name" content="hanx の 碎片栈">
<meta property="og:description" content="创建服务器12345678910var  http  =  require(&apos;http&apos;);http.createServer(function  (request,  response)  &amp;#123;  	//请求头    response.writeHead(200,  &amp;#123;&apos;Content-Type&apos;:  &apos;text/html;  charset=utf-8&apos;&amp;#125;);">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-16T16:05:43.949Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nodeJs入门">
<meta name="twitter:description" content="创建服务器12345678910var  http  =  require(&apos;http&apos;);http.createServer(function  (request,  response)  &amp;#123;  	//请求头    response.writeHead(200,  &amp;#123;&apos;Content-Type&apos;:  &apos;text/html;  charset=utf-8&apos;&amp;#125;);">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?e7cd7543c04aa55f06761709bc920324";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>




  <link rel="canonical" href="http://yoursite.com/2016/05/21/nodeJs入门/"/>





  <title>nodeJs入门 | hanx の 碎片栈</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">hanx の 碎片栈</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Time waits for no one</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/05/21/nodeJs入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="hanx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/20171022140737.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hanx の 碎片栈">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">nodeJs入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-21T23:16:06+08:00">
                2016-05-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/前端/" itemprop="url" rel="index">
                    <span itemprop="name">前端</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="创建服务器"><a href="#创建服务器" class="headerlink" title="创建服务器"></a>创建服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">	<span class="comment">//请求头</span></div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;  <span class="comment">//清除第2此访问          </span></div><div class="line">		response.write(<span class="string">"发送"</span>); <span class="comment">//输出</span></div><div class="line">        response.end(<span class="string">'baybay'</span>);<span class="comment">//不写则没有http协议尾,但写了会产生两次访问  </span></div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>); <span class="comment">//监听8080端口</span></div></pre></td></tr></table></figure>
<h3 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span>  otherfun  =  <span class="built_in">require</span>(<span class="string">'./models/otherfuns.js'</span>);</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		otherfun[<span class="string">"getVisit"</span>]();</div><div class="line">		<span class="comment">//或</span></div><div class="line">		otherfun.getVisit();</div><div class="line">		</div><div class="line">		response.end(<span class="string">''</span>);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//otherfuns.js</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//支持多个函数      </span></div><div class="line"><span class="built_in">module</span>.exports=&#123;      </div><div class="line">    getVisit:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;      </div><div class="line">    <span class="keyword">return</span>  visitnum++;      </div><div class="line">    &#125;,      </div><div class="line">    add:<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;      </div><div class="line">    <span class="keyword">return</span>  a+b;      </div><div class="line">    &#125;      </div><div class="line">&#125;  </div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">function fun2(res)&#123;</span></div><div class="line"><span class="comment">	console.log("我是fun2");</span></div><div class="line"><span class="comment">&#125;</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">module.exports  =  fun2;    //声明可以被调用，只支持一个函数 </span></div><div class="line"><span class="comment">*/</span></div></pre></td></tr></table></figure>
<h3 id="调用模块"><a href="#调用模块" class="headerlink" title="调用模块"></a>调用模块</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span>  user  =  <span class="built_in">require</span>(<span class="string">'./models/Teacher'</span>);</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		teacher  =  <span class="keyword">new</span>  Teacher(<span class="number">1</span>,<span class="string">'李四'</span>);</div><div class="line">		teacher.say();</div><div class="line">		response.end(<span class="string">''</span>);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//user.js</span></div><div class="line"></div><div class="line"><span class="comment">//写一个类</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params">id,name</span>)</span>&#123;</div><div class="line">	<span class="keyword">this</span>.id= id;</div><div class="line">	<span class="keyword">this</span>.name = name;</div><div class="line">	<span class="keyword">this</span>.enter=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"名字是:"</span>+<span class="keyword">this</span>.name);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports  =  user;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//teacher.js</span></div><div class="line"></div><div class="line"><span class="comment">//继承user</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Teacher</span>(<span class="params">id,name</span>)</span>&#123;</div><div class="line">	User.apply(<span class="keyword">this</span>,[id,name]);</div><div class="line">	<span class="keyword">this</span>.sya =<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"老师是:"</span>+<span class="keyword">this</span>.name);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="built_in">module</span>.exports   =   Teacher;</div></pre></td></tr></table></figure>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>截取url 字符串 根据字符串 调用方法 显示在页面上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span>  url  =  <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="keyword">var</span>  router  =  <span class="built_in">require</span>(<span class="string">'./router'</span>);</div><div class="line"></div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		<span class="comment">//拿到访问名</span></div><div class="line">		<span class="keyword">var</span> pathname = url.parse(request.url).pathname;</div><div class="line">		pathname = pathname.replace(<span class="regexp">/\//</span>, <span class="string">''</span>);<span class="comment">//替换斜杠</span></div><div class="line">		<span class="comment">//根据名字访问</span></div><div class="line">		router[pathname](request,response);</div><div class="line">		response.end(<span class="string">''</span>);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//router.js</span></div><div class="line"><span class="built_in">module</span>.exports=&#123;      </div><div class="line">    getVisit:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;      </div><div class="line">	res.write(<span class="string">"1"</span>);</div><div class="line">    &#125;,      </div><div class="line">    add:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;      </div><div class="line">	res.write(<span class="string">"2"</span>);</div><div class="line">    &#125;      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> optfile  =  <span class="built_in">require</span>(<span class="string">'./modeals/optfile'</span>);</div><div class="line"></div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		optfile.readfileSync(<span class="string">"./views/login.html"</span>);<span class="comment">//路径</span></div><div class="line">		</div><div class="line">		<span class="comment">//异步不能直接end用回调 闭包end</span></div><div class="line">		response.end(<span class="string">''</span>);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">//optfile.js</div><div class="line"></div><div class="line">//操作文件的类</div><div class="line">var  fs =  require(&apos;fs&apos;);</div><div class="line">module.exports=&#123;</div><div class="line">    readfile:function(path)&#123;</div><div class="line">		//异步执行</div><div class="line">        fs.readFile(path,  function  (err,  data)  &#123;</div><div class="line">            if  (err)  &#123;</div><div class="line">              console.log(err);</div><div class="line">            &#125;else&#123;</div><div class="line">              console.log(data.toString());</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        console.log(&quot;异步方法执行完毕&quot;);</div><div class="line">    &#125;,</div><div class="line">    readfileSync:function(path)&#123;</div><div class="line">		//同步读取</div><div class="line">        var  data  =  fs.readFileSync(path,&apos;utf-8&apos;);</div><div class="line">        //console.log(data);</div><div class="line">        console.log(&quot;同步方法执行完毕&quot;);</div><div class="line">        return  data;                </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> optfile  =  <span class="built_in">require</span>(<span class="string">'./modeals/optfile'</span>);</div><div class="line"></div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		optfile.writefile(<span class="string">"./views/login.txt"</span>,<span class="string">"内容"</span>);<span class="comment">//路径</span></div><div class="line">		</div><div class="line">		<span class="comment">//异步不能直接end用回调 闭包end</span></div><div class="line">		response.end(<span class="string">''</span>);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> 	</div><div class="line"><span class="comment">//optfile.js</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span>  fs=  <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="built_in">module</span>.exports=&#123;</div><div class="line">    writefile:<span class="function"><span class="keyword">function</span>(<span class="params">path,data</span>)</span>&#123;    <span class="comment">//异步方式</span></div><div class="line">        fs.writeFile(path,  data,  <span class="function"><span class="keyword">function</span>  (<span class="params">err</span>)  </span>&#123;</div><div class="line">            <span class="keyword">if</span>  (err)  &#123;</div><div class="line">                <span class="keyword">throw</span>  err;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'It\'s  saved!'</span>);  <span class="comment">//文件被保存</span></div><div class="line">          &#125;);</div><div class="line">    &#125;,</div><div class="line">    writeFileSync:<span class="function"><span class="keyword">function</span>(<span class="params">path,data</span>)</span>&#123;  <span class="comment">//同步方式</span></div><div class="line">        fs.writeFileSync(path,  data);</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"同步写文件完成"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="读取并显示图片"><a href="#读取并显示图片" class="headerlink" title="读取并显示图片"></a>读取并显示图片</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> optfile  =  <span class="built_in">require</span>(<span class="string">'./modeals/optfile'</span>);</div><div class="line"></div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;  </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'image/jpeg'</span>&#125;);  </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		<span class="comment">//如果写任何其他字符串会报错</span></div><div class="line">		optfile.readImg(<span class="string">'./img/pig.png'</span>,response);</div><div class="line">    &#125;  </div><div class="line">&#125;).listen(<span class="number">8080</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">//optfile.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span>  fs=  <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="built_in">module</span>.exports=&#123;</div><div class="line">    readImg:<span class="function"><span class="keyword">function</span>(<span class="params">path,res</span>)</span>&#123;</div><div class="line">		<span class="comment">//读取二进制流文件</span></div><div class="line">        fs.readFile(path,<span class="string">'binary'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,  file</span>)  </span>&#123;</div><div class="line">            <span class="keyword">if</span>  (err)  &#123;</div><div class="line">                <span class="built_in">console</span>.log(err);</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">				res.write(file,<span class="string">'binary'</span>);</div><div class="line">				res.end();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="路由改造"><a href="#路由改造" class="headerlink" title="路由改造"></a>路由改造</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"showimg"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>    http    =    <span class="built_in">require</span>(<span class="string">'http'</span>);    </div><div class="line"><span class="keyword">var</span>    url      =  <span class="built_in">require</span>(<span class="string">'url'</span>);</div><div class="line"><span class="keyword">var</span>    router  =    <span class="built_in">require</span>(<span class="string">'./router'</span>);  </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>    (<span class="params">request,    response</span>)    </span>&#123;    </div><div class="line"><span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;    <span class="comment">//清除第2此访问      </span></div><div class="line">	pathname=url.parse(request.url).pathname;</div><div class="line">	pathname  =  pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>);<span class="comment">//替换掉前面的/</span></div><div class="line">	router[pathname](request,response);</div><div class="line"> &#125;    </div><div class="line">&#125;).listen(<span class="number">8000</span>);    </div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server    running    at    http://127.0.0.1:8000/'</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//router.js</span></div><div class="line"><span class="keyword">var</span>  optfile  =  <span class="built_in">require</span>(<span class="string">'./models/optfile'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span>  <span class="title">getRecall</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    res.writeHead(<span class="number">200</span>,    &#123;<span class="string">'Content-Type'</span>:    <span class="string">'text/html;    charset=utf-8'</span>&#125;);  </div><div class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">recall</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">        res.write(data);</div><div class="line">        res.end(<span class="string">''</span>);<span class="comment">//不写则没有http协议尾</span></div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span>  recall;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=&#123;</div><div class="line">        login:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        	recall  =  getRecall(req,res);</div><div class="line">        	optfile.readfile(<span class="string">'./views/login.html'</span>,recall);</div><div class="line">        &#125;,</div><div class="line">        zhuce:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        	recall  =  getRecall(req,res);</div><div class="line">            optfile.readfile(<span class="string">'./views/zhuce.html'</span>,recall);</div><div class="line">        &#125;,</div><div class="line">    writefile:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        <span class="function"><span class="keyword">function</span>  <span class="title">recall</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">            res.write(data);</div><div class="line">            res.end(<span class="string">''</span>);<span class="comment">//不写则没有http协议尾</span></div><div class="line">        &#125;</div><div class="line">        optfile.writefile(<span class="string">'./views/one.txt'</span>,<span class="string">'今天阳光灿烂'</span>,recall);</div><div class="line">    &#125;,</div><div class="line">    showImg:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        <span class="comment">//如果是图片</span></div><div class="line">		res.writeHead(<span class="number">200</span>,    &#123;<span class="string">'Content-Type'</span>:<span class="string">'image/jpeg'</span>&#125;);</div><div class="line">        optfile.readImg(<span class="string">'./imgs/pig.png'</span>,res);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http = <span class="built_in">require</span>(<span class="string">'http'</span>);                                        </div><div class="line"><span class="keyword">var</span>  url = <span class="built_in">require</span>(<span class="string">'url'</span>);        </div><div class="line"><span class="keyword">var</span>  router = <span class="built_in">require</span>(<span class="string">'./router'</span>);    </div><div class="line"><span class="keyword">var</span>  exception = <span class="built_in">require</span>(<span class="string">'./models/Exception'</span>);</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,response</span>)</span>&#123;                                        </div><div class="line">	<span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		pathname = url.parse(request.url).pathname;        </div><div class="line">		pathname = pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>);<span class="comment">//拿到路由</span></div><div class="line">		<span class="comment">//异步要在自身回调函数里处理</span></div><div class="line">		<span class="keyword">try</span>&#123;        </div><div class="line">			router[pathname](request,response);    </div><div class="line">            response.write(data);</div><div class="line">            response.end(<span class="string">''</span>);</div><div class="line">		&#125;<span class="keyword">catch</span>(err)&#123;        </div><div class="line">			response.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html;charset=utf-8'</span>&#125;);        </div><div class="line">            response.write(err.toString());        </div><div class="line">            response.end(<span class="string">''</span>);</div><div class="line">		&#125;                                                                               &#125;                                        </div><div class="line">&#125;).listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<p>抛出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http = <span class="built_in">require</span>(<span class="string">'http'</span>);                                        </div><div class="line"><span class="keyword">var</span>  url = <span class="built_in">require</span>(<span class="string">'url'</span>);        </div><div class="line"><span class="keyword">var</span>  router = <span class="built_in">require</span>(<span class="string">'./router'</span>);    </div><div class="line"><span class="keyword">var</span>  exception = <span class="built_in">require</span>(<span class="string">'./models/Exception'</span>);</div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,response</span>)</span>&#123;                                        </div><div class="line">	<span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;</div><div class="line">		pathname = url.parse(request.url).pathname;        </div><div class="line">		pathname = pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>);<span class="comment">//拿到路由</span></div><div class="line">		<span class="comment">//异步要在自身回调函数里处理</span></div><div class="line">		<span class="keyword">try</span>&#123;        </div><div class="line">			<span class="comment">//router[pathname](request,response);    </span></div><div class="line">			data  =  exception.expfun(<span class="number">0</span>);</div><div class="line">            response.write(data);</div><div class="line">            response.end(<span class="string">''</span>);</div><div class="line">		&#125;<span class="keyword">catch</span>(err)&#123;        </div><div class="line">			response.writeHead(<span class="number">200</span>,&#123;<span class="string">'Content-Type'</span>:<span class="string">'text/html;charset=utf-8'</span>&#125;);        </div><div class="line">            response.write(err.toString());        </div><div class="line">            response.end(<span class="string">''</span>);</div><div class="line">		&#125;                                                                               &#125;                                        </div><div class="line">&#125;).listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//---------------Exception.js------------------------      </span></div><div class="line"><span class="built_in">module</span>.exports=&#123;      </div><div class="line">    expfun:<span class="function"><span class="keyword">function</span>(<span class="params">flag</span>)</span>&#123;      </div><div class="line">        <span class="keyword">if</span>(flag==<span class="number">0</span>)&#123;      </div><div class="line">            <span class="keyword">throw</span>  <span class="string">'我是例外'</span>;      </div><div class="line">        &#125;      </div><div class="line">        <span class="keyword">return</span>  <span class="string">"success"</span>;      </div><div class="line">    &#125;      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参数接受"><a href="#参数接受" class="headerlink" title="参数接受"></a>参数接受</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./login"</span> <span class="attr">method</span>=<span class="string">"get"</span> &gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>    http  =    <span class="built_in">require</span>(<span class="string">'http'</span>);                          </div><div class="line"><span class="keyword">var</span>    url   =    <span class="built_in">require</span>(<span class="string">'url'</span>);          </div><div class="line"><span class="keyword">var</span>    router  =    <span class="built_in">require</span>(<span class="string">'./router'</span>);        </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>                (<span class="params">request,                response</span>)                </span>&#123;                          </div><div class="line">            <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;                <span class="comment">//清除第2此访问              </span></div><div class="line">            pathname=url.parse(request.url).pathname;          </div><div class="line">            pathname        =        pathname.replace(<span class="regexp">/\//</span>,<span class="string">''</span>);<span class="comment">//替换掉前面的/          </span></div><div class="line">            <span class="keyword">try</span>&#123;          </div><div class="line">                router[pathname](request,response);      </div><div class="line">            &#125;<span class="keyword">catch</span>(err)&#123;          </div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'出错='</span>+err);        </div><div class="line">                response.writeHead(<span class="number">200</span>,    &#123;<span class="string">'Content-Type'</span>:    <span class="string">'text/html;    charset=utf-8'</span>&#125;);          </div><div class="line">                response.write(err);          </div><div class="line">                response.end(<span class="string">''</span>);      </div><div class="line">            &#125;      </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"server执行完毕"</span>);      </div><div class="line">                                            &#125;                          </div><div class="line">&#125;).listen(<span class="number">8000</span>);                          </div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Server                running                at                http://127.0.0.1:8000/'</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//router.js</span></div><div class="line"><span class="keyword">var</span>  optfile  =  <span class="built_in">require</span>(<span class="string">'./models/optfile'</span>);    </div><div class="line"><span class="keyword">var</span>  url  =  <span class="built_in">require</span>(<span class="string">'url'</span>);    </div><div class="line"></div><div class="line"><span class="keyword">var</span>  querystring  =  <span class="built_in">require</span>(<span class="string">'querystring'</span>);  <span class="comment">//post的话需导入    </span></div><div class="line"><span class="built_in">module</span>.exports=&#123;      </div><div class="line">    login:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;      </div><div class="line">        <span class="comment">//get方式接收 相当于同步执行</span></div><div class="line">        <span class="comment">//获取集合</span></div><div class="line">        <span class="keyword">var</span> rdata  =  url.parse(req.url,<span class="literal">true</span>).query;      </div><div class="line">        <span class="keyword">if</span>(rdata[<span class="string">'email'</span>]!=<span class="literal">undefined</span>)&#123;  </div><div class="line">		<span class="comment">//根据NAME取</span></div><div class="line">            <span class="built_in">console</span>.log(rdata[<span class="string">'email'</span>]);      </div><div class="line">		&#125;    </div><div class="line">		</div><div class="line">        <span class="comment">//post方式接收参数</span></div><div class="line">        <span class="comment">//定义了一个post变量，用于暂存请求体的信息      </span></div><div class="line">        <span class="keyword">var</span>  post = <span class="string">''</span>;</div><div class="line">        req.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;<span class="comment">//通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中 ，这是异步的</span></div><div class="line">            post+=chunk;      </div><div class="line">        &#125;);</div><div class="line">		</div><div class="line">		<span class="comment">//在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。      </span></div><div class="line">        req.on(<span class="string">'end'</span>,  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;        </div><div class="line">            post  =  querystring.parse(post);</div><div class="line">			<span class="comment">//处理后成为一个集合</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'email:'</span>+post[<span class="string">'email'</span>]+<span class="string">'\n'</span>);</div><div class="line">			<span class="built_in">console</span>.log(<span class="string">'pwd:'</span>+post[<span class="string">'pwd'</span>]+<span class="string">'\n'</span>);</div><div class="line">        &#125;);      </div><div class="line"></div><div class="line">        data  =  optfile.readfileSync(<span class="string">'./views/login.html'</span>);      </div><div class="line">        res.write(data);      </div><div class="line">        res.end();      </div><div class="line">    &#125;      </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="动态网页"><a href="#动态网页" class="headerlink" title="动态网页"></a>动态网页</h3><p>html放置替换标记<br>获取<br>进行替换<br>写入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">login:<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        <span class="comment">//--------get方式接收参数----------------  </span></div><div class="line">        <span class="comment">/*</span></div><div class="line"><span class="comment">        var    rdata    =    url.parse(req.url,true).query;    </span></div><div class="line"><span class="comment">        console.log(rdata);  </span></div><div class="line"><span class="comment">        if(rdata['email']!=undefined)&#123;</span></div><div class="line"><span class="comment">            console.log(rdata['email']); </span></div><div class="line"><span class="comment">            console.log(rdata['pwd']);</span></div><div class="line"><span class="comment">        &#125;</span></div><div class="line"><span class="comment">        */</span></div><div class="line">        <span class="comment">//-------post方式接收参数---------------- </span></div><div class="line">        <span class="keyword">var</span>  post  =  <span class="string">''</span>;<span class="comment">//定义了一个post变量，用于暂存请求体的信息    </span></div><div class="line">        req.on(<span class="string">'data'</span>,  <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;        <span class="comment">//通过req的data事件监听函数，每当接受到请求体的数据，就累加到post变量中    </span></div><div class="line">            post  +=  chunk;    </div><div class="line">        &#125;);    </div><div class="line">        <span class="comment">//-------注意异步-------------    </span></div><div class="line">        req.on(<span class="string">'end'</span>,  <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;        <span class="comment">//在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。    </span></div><div class="line">            post  =  querystring.parse(post);    </div><div class="line">            <span class="comment">//console.log('email:'+post['email']+'\n');    </span></div><div class="line">            <span class="comment">//console.log('pwd:'+post['pwd']+'\n');</span></div><div class="line">            </div><div class="line">            <span class="comment">//recall = getRecall(req,res);</span></div><div class="line">            arr = [<span class="string">'email'</span>,<span class="string">'pwd'</span>];</div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">recall</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">                dataStr = data.toString();</div><div class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</div><div class="line">                    re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'&#123;'</span>+arr[i]+<span class="string">'&#125;'</span>,<span class="string">'g'</span>); <span class="comment">// /\&#123;name\&#125;/g</span></div><div class="line">                    dataStr = dataStr.replace(re,post[arr[i]]);</div><div class="line">                &#125;</div><div class="line">                res.write(dataStr);</div><div class="line">                res.end(<span class="string">''</span>);<span class="comment">//不写则没有http协议尾</span></div><div class="line">            &#125;</div><div class="line">            optfile.readfile(<span class="string">'./views/login.html'</span>,recall);</div><div class="line">        &#125;); </div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h3 id="异步流程控制对象"><a href="#异步流程控制对象" class="headerlink" title="异步流程控制对象"></a>异步流程控制对象</h3><p>安装<br>npm install async –save-dev</p>
<p>1.串行无关联：async.series(tasks,callback);<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">'async'</span>);   </div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span>&#123;  </div><div class="line">    <span class="keyword">async</span>.series(&#123;   </div><div class="line">        one: <span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;  </div><div class="line">            ii=<span class="number">0</span>;  </div><div class="line">            setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'aaa='</span>+<span class="keyword">new</span> <span class="built_in">Date</span>());  </div><div class="line">                ii++;  </div><div class="line">                <span class="keyword">if</span>(ii==<span class="number">3</span>)&#123;  </div><div class="line">                    clearInterval(<span class="keyword">this</span>);  </div><div class="line">                    <span class="comment">//回调不执行 下面就不会继续执行，如果出错 下面将会中断</span></div><div class="line">					done(<span class="literal">null</span>,&#123;<span class="attr">one</span>:<span class="string">"one"</span>&#125;);  </div><div class="line">                &#125;  </div><div class="line">            &#125;,<span class="number">1000</span>);  </div><div class="line">        &#125;,  </div><div class="line">        two: <span class="function"><span class="keyword">function</span>(<span class="params">done</span>)</span>&#123;  </div><div class="line">            jj=<span class="number">0</span>;  </div><div class="line">            setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  </div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'bbb='</span>+<span class="keyword">new</span> <span class="built_in">Date</span>());  </div><div class="line">                jj++;  </div><div class="line">                <span class="keyword">if</span>(jj&gt;<span class="number">3</span>)&#123;  </div><div class="line">                    clearInterval(<span class="keyword">this</span>);  </div><div class="line">                    done(<span class="literal">null</span>,&#123;<span class="attr">two</span>:<span class="string">"two"</span>&#125;);  </div><div class="line">                &#125;  </div><div class="line">            &#125;,<span class="number">1000</span>);  </div><div class="line">        &#125;  </div><div class="line">    &#125;,  </div><div class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err,rs</span>) </span>&#123;   </div><div class="line">            <span class="built_in">console</span>.log(err);  </div><div class="line">            <span class="built_in">console</span>.log(rs);  </div><div class="line">        &#125;);  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.并行无关联：async.parallel(tasks,callback);<br>多个函数并行执行，最后汇总结果,如果某一个流程出错就退出<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span>.parallel(&#123;     </div><div class="line">	<span class="comment">//出错继续执行 回调则会卡主</span></div><div class="line">    one: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;     </div><div class="line">        callback(<span class="literal">null</span>, <span class="number">1</span>);     </div><div class="line">    &#125;,     </div><div class="line">    two: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;     </div><div class="line">        callback(<span class="literal">null</span>, <span class="number">2</span>);     </div><div class="line">    &#125;     </div><div class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;     </div><div class="line">    <span class="built_in">console</span>.log(results);     </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>3.串行有关联:waterfall<br>每一步执行时需要由上一步执行的结果当做参数.所以每一步必须串行等待<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">async</span>.waterfall([     </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;     </div><div class="line">     </div><div class="line">        done(<span class="literal">null</span>, <span class="string">'one'</span>);     </div><div class="line">    &#125;,     </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">onearg, done</span>) </span>&#123;     </div><div class="line">     </div><div class="line">        done(<span class="literal">null</span>, onearg + <span class="string">'| two'</span>);     </div><div class="line">    &#125;,     </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">twoarg, done</span>) </span>&#123;     </div><div class="line">     </div><div class="line">        done(<span class="literal">null</span>, twoarg + <span class="string">'| three'</span>);     </div><div class="line">    &#125;,     </div><div class="line">    <span class="function"><span class="keyword">function</span> (<span class="params">threearg, done</span>) </span>&#123;     </div><div class="line">     </div><div class="line">        done(<span class="literal">null</span>, threearg + <span class="string">'| four'</span>);     </div><div class="line">    &#125;     </div><div class="line">], <span class="function"><span class="keyword">function</span> (<span class="params">error, result</span>) </span>&#123;     </div><div class="line">    <span class="built_in">console</span>.log(result);     </div><div class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">'waterfall'</span>);     </div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="链接mysql"><a href="#链接mysql" class="headerlink" title="链接mysql"></a>链接mysql</h3><p>安装<br>npm install mysql</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="number">3.</span>直连mysql   </div><div class="line"><span class="keyword">var</span> mysql  = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  <span class="comment">//调用MySQL模块</span></div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;      </div><div class="line">    host: <span class="string">'localhost'</span>,       <span class="comment">//主机  </span></div><div class="line">    user: <span class="string">'root'</span>,               <span class="comment">//MySQL认证用户名  </span></div><div class="line">    password: <span class="string">'root'</span>,        <span class="comment">//MySQL认证用户密码  </span></div><div class="line">    database: <span class="string">'test'</span>,  </div><div class="line">    port: <span class="string">'3306'</span>                   <span class="comment">//端口号  </span></div><div class="line">&#125;);</div><div class="line"><span class="comment">//创建一个connection  </span></div><div class="line">connection.connect(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(err)&#123;         </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span>+err);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection connect]  succeed!'</span>);  </div><div class="line">&#125;); </div><div class="line"><span class="comment">//----插入</span></div><div class="line"><span class="keyword">var</span> userAddSql = <span class="string">'insert into user (uname,pwd) values(?,?)'</span>;</div><div class="line"><span class="keyword">var</span> param = [<span class="string">'ccc'</span>,<span class="string">'ccc'</span>];</div><div class="line">connection.query(userAddSql,param,<span class="function"><span class="keyword">function</span>(<span class="params">err,rs</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(err)&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'insert err:'</span>,err.message);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'insert success'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//执行查询  </span></div><div class="line">connection.query(<span class="string">'SELECT * from user where uid=?'</span>,[<span class="number">2</span>], <span class="function"><span class="keyword">function</span>(<span class="params">err, rs</span>) </span>&#123;  </div><div class="line">    <span class="keyword">if</span> (err) &#123;  </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span>+err);  </div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125; </div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;rs.length;i++)&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, rs[i].uname); </div><div class="line">    &#125;</div><div class="line">&#125;);   </div><div class="line"></div><div class="line"><span class="comment">//关闭connection  </span></div><div class="line">connection.end(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;  </div><div class="line">    <span class="keyword">if</span>(err)&#123; </div><div class="line">        <span class="built_in">console</span>.log(err.toString());</div><div class="line">        <span class="keyword">return</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'[connection end] succeed!'</span>);  </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h3><p>安装<br>npm install -g node-mysql   //-g表全局  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mysql  = <span class="built_in">require</span>(<span class="string">'mysql'</span>);  <span class="comment">//调用MySQL模块 </span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">OptPool</span>(<span class="params"></span>)</span>&#123; </div><div class="line">    <span class="keyword">this</span>.flag=<span class="literal">true</span>; <span class="comment">//是否连接过 </span></div><div class="line">    <span class="keyword">this</span>.pool = mysql.createPool(&#123;     </div><div class="line">        host: <span class="string">'localhost'</span>,       <span class="comment">//主机 </span></div><div class="line">        user: <span class="string">'root'</span>,               <span class="comment">//MySQL认证用户名 </span></div><div class="line">        password: <span class="string">'root'</span>,        <span class="comment">//MySQL认证用户密码 </span></div><div class="line">        database: <span class="string">'test'</span>, </div><div class="line">        port: <span class="string">'3306'</span>                   <span class="comment">//端口号 </span></div><div class="line">    &#125;); </div><div class="line"> </div><div class="line">    <span class="keyword">this</span>.getPool=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.flag)&#123; </div><div class="line">            <span class="comment">//监听connection事件 </span></div><div class="line">            <span class="keyword">this</span>.pool.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">connection</span>) </span>&#123;  </div><div class="line">                connection.query(<span class="string">'SET SESSION auto_increment_increment=1'</span>); </div><div class="line">                <span class="keyword">this</span>.flag=<span class="literal">false</span>; </div><div class="line">            &#125;); </div><div class="line">        &#125; </div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.pool; </div><div class="line">    &#125; </div><div class="line">&#125;; </div><div class="line"><span class="built_in">module</span>.exports = OptPool;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="number">4.</span>调用：  </div><div class="line"><span class="keyword">var</span> OptPool = <span class="built_in">require</span>(<span class="string">'./models/OptPool'</span>); </div><div class="line"> </div><div class="line"><span class="keyword">var</span> optPool = <span class="keyword">new</span> OptPool(); </div><div class="line"><span class="keyword">var</span> pool = optPool.getPool(); </div><div class="line"></div><div class="line"><span class="comment">//执行SQL语句 </span></div><div class="line">pool.getConnection(<span class="function"><span class="keyword">function</span>(<span class="params">err,conn</span>)</span>&#123; </div><div class="line">    <span class="comment">//----插入 </span></div><div class="line">    <span class="keyword">var</span> userAddSql = <span class="string">'insert into user (uname,pwd) values(?,?)'</span>; </div><div class="line">    <span class="keyword">var</span> param = [<span class="string">'eee'</span>,<span class="string">'eee'</span>];</div><div class="line">    conn.query(userAddSql,param,<span class="function"><span class="keyword">function</span>(<span class="params">err,rs</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(err)&#123; </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'insert err:'</span>,err.message); </div><div class="line">            <span class="keyword">return</span>; </div><div class="line">        &#125; </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'insert success'</span>); </div><div class="line">        <span class="comment">//conn.release(); //放回连接池</span></div><div class="line">    &#125;)</div><div class="line">    <span class="comment">//查询 </span></div><div class="line">    conn.query(<span class="string">'SELECT * from user'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, rs</span>) </span>&#123; </div><div class="line">        <span class="keyword">if</span> (err) &#123; </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'[query] - :'</span>+err); </div><div class="line">            <span class="keyword">return</span>; </div><div class="line">        &#125;   </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;rs.length;i++)&#123;</div><div class="line">            <span class="built_in">console</span>.log(rs[i].uname); </div><div class="line">        &#125;</div><div class="line">        conn.release(); <span class="comment">//放回连接池</span></div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="事件处理机制"><a href="#事件处理机制" class="headerlink" title="事件处理机制"></a>事件处理机制</h3><p>emitter.addListener(event, listener)==on //添加监听<br>emitter.on(event, listener)<br>emitter.once(event, listener)//一次性的监听器<br>emitter.removeListener(event, listener) //删除指定监听<br>emitter.removeAllListeners([event]) //删除所有监听<br>emitter.setMaxListeners(n) //默认情况下当一个事件的监听超过10个时，EventEmitter 将打印警告信息，0表无限制<br>emitter.listeners(event) //返回特定事件的事件监听器集合<br>emitter.emit(event, [arg1], [arg2], […])  //用提供的参数按顺序执行每个事件监听器。  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  http  =  <span class="built_in">require</span>(<span class="string">'http'</span>);   </div><div class="line"><span class="keyword">var</span>  events=<span class="built_in">require</span>(<span class="string">"events"</span>);    </div><div class="line"><span class="keyword">var</span>  UserBean  =  <span class="built_in">require</span>(<span class="string">'./models/UserBean'</span>);   </div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>  (<span class="params">request,  response</span>)  </span>&#123;   </div><div class="line">    response.writeHead(<span class="number">200</span>,  &#123;<span class="string">'Content-Type'</span>:  <span class="string">'text/html;  charset=utf-8'</span>&#125;);   </div><div class="line">    <span class="keyword">if</span>(request.url!==<span class="string">"/favicon.ico"</span>)&#123;   </div><div class="line">        user  =  <span class="keyword">new</span>  UserBean();   </div><div class="line">        user.eventEmit.once(<span class="string">'zhuceSuc'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">uname,pwd</span>)</span>&#123; </div><div class="line">            response.write(<span class="string">'注册成功'</span>); </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'传来uname:'</span>+uname); </div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'传来pwd:'</span>+pwd); </div><div class="line">            user.login(request,response); </div><div class="line">            response.end(<span class="string">''</span>); </div><div class="line">        &#125;);<span class="comment">//注册监听   </span></div><div class="line">        user.zhuce(request,  response); </div><div class="line">    &#125;   </div><div class="line">&#125;).listen(<span class="number">8000</span>);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> events=<span class="built_in">require</span>(<span class="string">"events"</span>);    </div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);    </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">UserBean</span>(<span class="params"></span>)</span>&#123;    </div><div class="line">    <span class="keyword">this</span>.eventEmit = <span class="keyword">new</span> events.EventEmitter(); </div><div class="line">    <span class="keyword">this</span>.zhuce=<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123; </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"注册"</span>); </div><div class="line">        req[<span class="string">'uname'</span>]=<span class="string">"aa"</span>; </div><div class="line">        req[<span class="string">'pwd'</span>]=<span class="string">"bb"</span>; </div><div class="line">        <span class="keyword">this</span>.eventEmit.emit(<span class="string">'zhuceSuc'</span>,<span class="string">'aa'</span>,<span class="string">'bb'</span>);  <span class="comment">//抛出事件消息 </span></div><div class="line">    &#125;, </div><div class="line">    <span class="keyword">this</span>.login=<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123; </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"登录"</span>); </div><div class="line">        res.write(<span class="string">"用户名:"</span>+req[<span class="string">'uname'</span>]); </div><div class="line">        res.write(<span class="string">"密码:"</span>+req[<span class="string">'pwd'</span>]); </div><div class="line">        res.write(<span class="string">"登录"</span>); </div><div class="line">    &#125;    </div><div class="line">&#125;    </div><div class="line">    </div><div class="line"><span class="built_in">module</span>.exports = UserBean;</div></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/nodejs/" rel="tag"># nodejs</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/05/20/ES6 ES2015核心内容/" rel="next" title="ES6/ES2015核心内容">
                <i class="fa fa-chevron-left"></i> ES6/ES2015核心内容
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/06/06/一句话概括下spring框架及spring cloud框架主要组件/" rel="prev" title="一句话概括下spring框架及spring cloud框架主要组件">
                一句话概括下spring框架及spring cloud框架主要组件 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/20171022140737.png"
                alt="hanx" />
            
              <p class="site-author-name" itemprop="name">hanx</p>
              <p class="site-description motion-element" itemprop="description">向死而生</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">49</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建服务器"><span class="nav-number">1.</span> <span class="nav-text">创建服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数调用"><span class="nav-number">2.</span> <span class="nav-text">函数调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用模块"><span class="nav-number">3.</span> <span class="nav-text">调用模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由"><span class="nav-number">4.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文件读取"><span class="nav-number">5.</span> <span class="nav-text">文件读取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#写入文件"><span class="nav-number">6.</span> <span class="nav-text">写入文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#读取并显示图片"><span class="nav-number">7.</span> <span class="nav-text">读取并显示图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由改造"><span class="nav-number">8.</span> <span class="nav-text">路由改造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常处理"><span class="nav-number">9.</span> <span class="nav-text">异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参数接受"><span class="nav-number">10.</span> <span class="nav-text">参数接受</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动态网页"><span class="nav-number">11.</span> <span class="nav-text">动态网页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步流程控制对象"><span class="nav-number">12.</span> <span class="nav-text">异步流程控制对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#链接mysql"><span class="nav-number">13.</span> <span class="nav-text">链接mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#连接池"><span class="nav-number">14.</span> <span class="nav-text">连接池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件处理机制"><span class="nav-number">15.</span> <span class="nav-text">事件处理机制</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    ❤
  </span>
  <span class="author" itemprop="copyrightHolder">hanx</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  1052685403@qq.com




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  

  
  

  

  

  

</body>
</html>
